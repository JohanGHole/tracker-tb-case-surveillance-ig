/// url = "http://example.org/StructureMap/OutcomeQRToLM"
/// name = 'OutcomeQRToLM'
/// description = "map outcome questionnaire response to logical model"

uses "http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse" alias QResp as source
uses "http://example.org/StructureDefinition/Outcome" alias OutcomeLM as target

group OutcomeQRToLM ( source qr : QResp, target outcome : OutcomeLM) {

  qr.item as item then {

    item.answer first as answer where item.linkId = 'executionDate' then {
      answer.value as content -> outcome.executionDate = content  "SetExecutionDate";
    } "FirstAnswerForExecutionDate";

    item.answer first as answer where item.linkId = 'treatmentOutcome' then {
      answer.value as coding -> outcome.treatmentOutcome = coding "SetTreatmentOutcome";
    } "FirstAnswerForTreatmentDate";

    item.answer first as answer where item.linkId = 'reasonForDenotification' then {
      answer.value as coding -> outcome.reasonForDenotification = coding "SetReasonForDenotification";
    } "FirstAnswerForReasonForDenotification";

    item.answer first as answer where item.linkId = 'provideDuplicateSRecordNumber' then {
      answer.value as content -> outcome.provideDuplicateSRecordNumber = content "SetProvideDuplicateSRecordNumber";
    } "FirstAnswerForProvideDuplicateSRecordNumber";

    item.answer first as answer where item.linkId = 'treatmentOutcomeDelayWeeks' then {
      answer.value as content -> outcome.treatmentOutcomeDelayWeeks = content "SetTreatmentOutcomeDelayWeeks";
    } "FirstAnswerForTreatmentOutcomeDelayWeeks";

    item.answer first as answer where item.linkId = 'provideEvidenceForDenotifyingTheCase' then {
      answer.value as content -> outcome.provideDuplicateSRecordNumber = content "SetProvideEvidenceForDenotifyingTheCase";
    } "FirstAnswerForProvideEvidenceForDenotifyingTheCase";

    item.answer first as answer where item.linkId = 'denotifyTheCase' then {
      answer.value as content -> outcome.provideDuplicateSRecordNumber = content "SetDenotifyTheCase";
    } "FirstAnswerForDenotifyTheCase";
  
  } "processItems";

}